var app={init:function(){state.load();var e=state.get("version");$("#version").text(e);var t=$("#btn-feedback").parent().attr("href");t+="-"+e.replace(/ /g,""),$("#btn-feedback").parent().attr("href",t),$(".button").each(function(){$(this).mousedown(function(){$(this).addClass("focus")}).mouseup(function(){$(this).removeClass("focus")}).click(function(){$("#menu").hasClass("visible")&&($("#menu").removeClass("visible"),$("#menu-bg").fadeOut())})}),$("#levels select").on("change",function(){state.switchLevel($(this).val()),$("#menu").hasClass("visible")&&($("#menu").removeClass("visible"),$("#menu-bg").fadeOut())}),$("#btn-theme").click(function(){var e="day";"day"==$("html").attr("data-theme")&&(e="night"),app.setTheme(e)}),$("#btn-clr").click(function(){state.resetGrades(),app.populateSubjects()}),$("#btn-gpa").click(function(){var e=state.get("isGpa");app.setGpa(!e)}),$("#menu-toggle").click(function(){$("#menu").hasClass("visible")?($("#menu").removeClass("visible"),$("#menu-bg").fadeOut()):($("#menu").addClass("visible"),$("#menu-bg").fadeIn())}),$("#menu-bg").click(function(){$("#menu").removeClass("visible"),$(this).fadeOut()})},setTheme:function(e){var t="day"==e?"Night":"Day";$("#btn-theme span").text(t+" mode"),$("html").attr("data-theme",e),state.set("dispMode",e)},setGpa:function(e){var t=e?"GWA mode":"cGPA mode (alpha)";$("#btn-gpa span").text(t),state.set("isGpa",e),app.calculate()},setColors:function(e){$("#app").attr("data-theme",e)},populateSubjects:function(){var e=state.get("grades");if(e.length==subjects.default.length){$("#grades table").empty();for(var t=0;t<subjects.default.length;t++){var a=subjects.default[t],s=a.name+" ("+a.units.toFixed(1)+" units)",n=e[t].toFixed(2),i=this.createSubjectRow(t,s,n);$("#grades table").append(i)}app.calculate()}else console.error("currGrades does not fit subjects.default")},createSubjectRow:function(e,t,a){var s=$("<tr>").attr("data-subject",e),n=$("<td>"),i=$("<p>").text(t),r=$("<h2>").addClass("num").text(a),c=$("<td>").addClass("controls"),u=$("<div>").addClass("plus"),o=$("<div>").addClass("minus");return $(o).click(function(){var e=$(this).parent().parent().attr("data-subject"),t=state.getGrade(parseInt(e));1<t&&(t-=3<t?1:.25),state.setGrade(e,t),$("tr[data-subject="+e+"] h2").text(t.toFixed(2)),app.calculate()}),$(u).click(function(){var e=$(this).parent().parent().attr("data-subject"),t=state.getGrade(parseInt(e));t<5&&(t+=2.75<t?1:.25),state.setGrade(e,t),$("tr[data-subject="+e+"] h2").text(t.toFixed(2)),app.calculate()}),$(r).click(function(){var e=$(this).parent().parent().attr("data-subject");app.promptGrade(e)}),$(n).append(i).append(r),$(c).append(o).append(u),$(s).append(n).append(c),s},promptGrade:function(e){state.getGrade(parseInt(e));var t=subjects.default[e].name,a=window.prompt("Enter grade for "+t),s=calc.isValid(a);0<a.length&&(s.result?window.alert("Invalid grade entered: "+s.reason):(a=parseFloat(a),$("tr[data-subject="+e+"] h2").text(a.toFixed(2)),state.setGrade(e,a),app.calculate()))},calculate:function(){var e=calc.ulate();$("#gwa").text(e.substring(0,5))}},calc={ulate:function(){for(var e=0,t=0,a=state.get("isGpa"),s=0;s<subjects.default.length;s++){var n=subjects.default[s].units;e+=n;var i=state.getGrade(s);a&&(i=this.convertToGpa(i)),t+=i*n}return""+(t/e).toFixed(10)},convertToGpa:function(e){var t;switch(parseFloat(e)){case 1:t=4;break;case 1.25:t=3.7;break;case 1.5:t=3.3;break;case 1.75:t=3;break;case 2:t=2.7;break;case 2.25:t=2.3;break;case 2.5:t=2;break;case 2.75:t=1.7;break;case 3:t=1.3;break;case 4:t=1;break;default:t=0}return t},isValid:function(e){var t=parseFloat(e),a="";return/[^0-9\.]+/.test(e)?a="contains invalid characters":t<1||5<t?a=t+" is out of range":t<3&&t%.25!=0?a="no such grade":(3<t&&t<4||4<t&&t<5)&&(a="no such grade"),{result:0<a.length,reason:a}}},state={current:{version:"10",versionCode:12,set:"seven",grades:[],dispMode:"day",isGpa:!1},get:function(e){return this.current[e]},set:function(e,t){if(this.current[e]=t,void 0!==typeof Storage){var a=this.current,s=JSON.stringify(a);localStorage.setItem("gwadata",s)}},getGrade:function(e){return this.current.grades[e]},setGrade:function(e,t){this.current.grades[e]=t,this.set("grades",this.current.grades)},switchLevel:function(e,t){t||this.resetGrades(e),this.set("set",e),subjects.default=subjects[e],app.populateSubjects(),app.setColors(e)},resetGrades:function(e){e=e||this.get("set"),console.log("Resetting grades for "+e);for(var t=[],a=0;a<subjects[e].length;a++)t.push(1);this.set("grades",t)},load:function(){if(void 0!==typeof Storage){var e=localStorage.getItem("gwadata");if(null!=e){console.log("Data exists, loading");var t=JSON.parse(e);if(null!=t.set&&1<t.grades.length){if(console.log("Restoring state for "+t.set),void 0===t.version||t.versionCode<this.current.versionCode||"string"==typeof t.grades[0]){console.log("Upgrading data from v<10");for(var a=[],s=0;s<t.grades.length;s++){var n=parseFloat(t.grades[s]);a.push(n)}this.set("grades",a)}else this.current.grades=t.grades;$("#levels select").val(t.set),this.switchLevel(t.set,!0),app.setGpa(t.isGpa),app.setTheme(t.dispMode),app.populateSubjects()}else console.warn("Data is invalid, resetting"),this.switchLevel("seven"),app.populateSubjects()}else console.log("Data does not exist, initializing"),this.switchLevel("seven"),app.populateSubjects()}else $("tr.loader td").text("Please use a newer browser.")}},subjects={seven:[{name:"Integrated Science",units:1.7},{name:"Mathematics",units:1.7},{name:"Computer Science",units:1},{name:"English",units:1.3},{name:"Filipino",units:1},{name:"Social Science",units:1},{name:"PEHM",units:1},{name:"Values Education",units:.7},{name:"AdTech",units:1}],eight:[{name:"Integrated Science",units:2},{name:"Mathematics",units:1.7},{name:"Computer Science",units:1},{name:"English",units:1.3},{name:"Filipino",units:1},{name:"Social Science",units:1},{name:"PEHM",units:1},{name:"Values Education",units:.7},{name:"AdTech",units:1},{name:"Earth Science",units:.7}],nine:[{name:"Biology",units:1},{name:"Chemistry",units:1},{name:"Physics",units:1},{name:"Mathematics",units:1},{name:"English",units:1},{name:"Filipino",units:1},{name:"Social Science",units:1},{name:"PEHM",units:1},{name:"Statistics",units:1},{name:"Computer Science",units:1}],ten:[{name:"Biology",units:1},{name:"Chemistry",units:1},{name:"Physics",units:1},{name:"Mathematics",units:1.3},{name:"English",units:1},{name:"Filipino",units:1},{name:"Social Science",units:1},{name:"PEHM",units:1},{name:"Research",units:1},{name:"Computer Science",units:1},{name:"Elective",units:1}],tweleven:[{name:"Research",units:2},{name:"Core Science",units:1.7},{name:"Elective",units:1.7},{name:"Mathematics",units:1},{name:"English",units:1},{name:"Filipino",units:1},{name:"Social Science",units:1}]};