function displayMode(t){switch(t){case"day":$("html").removeClass("night"),$("#c_nm span").text("off");break;case"night":$("html").addClass("night"),$("#c_nm span").text("on");break;case"auto":$("#c_nm span").text("auto");var e=(new Date).getHours();e>16||e<5?$("html").addClass("night"):$("html").removeClass("night")}}function calculateBatches(){var t=new Date,e=t.getFullYear(),s=t.getMonth();oldestBatch=2017==e?2018:s<6?e:++e,batches.tweleven=oldestBatch+" & "+ ++oldestBatch,batches.ten=++oldestBatch,batches.nine=++oldestBatch,batches.eight=++oldestBatch,batches.seven=++oldestBatch}function unitsHandler(t){t?$("input").each(function(){var t=parseInt($(this).attr("data-subject")),e=grade.default[t].units.toFixed(1);$(this).attr("placeholder",e+" units")}):$("input").each(function(){$(this).removeAttr("placeholder")}),calculate()}function redraw(t){$("input, .lock").each(function(){$(this).remove()}),$("#g").attr("class","").text("Welcome");for(var e=1;e<4;e++)$("#pane-"+e).remove(),$("#app .row").append($("<div></div>").addClass("col-lg-4").attr("id","pane-"+e));for(var s=0,a=function(e){var a=void 0!==state.current.lock&&state.current.lock[e],n=!0===a?"img/locked.min.svg":"img/unlocked.min.svg",i=e<4?1:e<8?2:3,c=$("<div></div>").addClass("subject"),u=$("<span></span>"),r=$("<img>").addClass("lock").attr("src",n),l=($("<img>").attr("src","img/settings.min.svg"),$("<div></div>").addClass("grade-control").append(r)),o=$("<input>").attr("type","number").attr("step","0.25").attr("data-subject",e);!0===a&&$(o).attr("disabled","disabled"),null!=t&&$(o).val(t[e]),$(u).text(grade.default[e].subject),$(c).append(u).append(l).append(o),$("#pane-"+i).append(c),s++},n=0;n<4;n++)a(n);for(n=4;n<grade.default.length;n++)a(n);if(grade.default.length>8)for(n=s;n<grade.default.length;n++)a(n);else $("#pane-3").remove(),$("#pane-1").addClass("col-lg-offset-2");var i=$("input");$(i).each(function(){$(this).on("change paste keyup input",function(t){if($(this).val().length>4){var e=$(this).val().slice(0,4);$(this).val(e)}state.change(this)})}),null!=t&&calculate(),$(".lock").each(function(){$(this).click(function(){var t=$(this).closest(".subject").children("input"),e=!$(t)[0].hasAttribute("disabled");e?($(t).attr("disabled","disabled"),$(this).attr("src","img/locked.min.svg")):($(t).removeAttr("disabled"),$(this).attr("src","img/unlocked.min.svg")),state.toggle(t,e)})}),unitsHandler(state.current.showUnits)}function hopToNext(t){var e=$(t).val();if(4==e.length&&!isInvalidGrade(parseFloat(e))){var s=$("input"),a=parseInt($(s[s.length-1]).attr("data-subject")),n=parseInt($(t).attr("data-subject"));n!=a&&($(t).blur(),$("input[data-subject="+(n+1)+"]").focus())}}function isInvalidGrade(t){var e=parseFloat(t),s=!1;return/[^0-9\.]+/.test(t)?s=!0:e<1||e>5?s=!0:e<3&&e%.25!=0?s=!0:(e>3&&e<4||e>4&&e<5)&&(s=!0),s}function calculate(){var t,e=0,s=0,a=0;if($("input").each(function(){var t=$(this).val(),n=$(this).attr("data-subject");return a+=grade.default[n].units,t?isInvalidGrade(t)?(e=1,!1):(e=2,void(s+=parseFloat(t)*grade.default[n].units)):(e=0,!0)}),t=s/a,welcomeText=state.current.showUnits?a.toFixed(1)+" units":"Welcome",0==e)$("#g").attr("class","").text(welcomeText);else if(1==e)$("#g").attr("class","err").text("Error");else{var n=t.toPrecision(10)+"";$("#g").removeAttr("class").text(n.slice(0,5)),t<=1.5&&0!=t&&$("#g").addClass("dl")}}$(document).ready(function(){$("#vc").text(6),calculateBatches(),grade.default=grade.seven,state.load(),$("li").each(function(t){$(this).click(function(t){var e=$(this).children();t.preventDefault(),state.update($(e).attr("data-item"),null)});var e=batches[$(this).children().attr("data-item")];$(this).children().text("Batch "+e)}),$("#c_nm").click(function(){var t,e=$("#c_nm span").text();switch(e){case"off":t="night";break;case"on":t="auto";break;case"auto":t="day"}console.log(e,t),state.current.dispMode=t,state.save(),displayMode(t),$("#hamburger").removeAttr("class"),$("#menu .menu-content").addClass("invis")}),$("#c_units").click(function(){$("#hamburger").removeAttr("class"),$("#menu .menu-content").addClass("invis");var t=!state.current.showUnits;return state.current.showUnits=t,state.save(),t?$("#c_units span").text("on"):$("#c_units span").text("off"),unitsHandler(t)}),$("#hamburger").click(function(){$(this).hasClass("active")?($(this).removeAttr("class"),$("#menu .menu-content").addClass("invis")):($(this).addClass("active"),$("#menu .menu-content").removeClass("invis"),window.setTimeout(function(){$(document).one("click",function(t){$(t.target).closest(".menu-content").length||($("#hamburger").removeAttr("class"),$("#menu .menu-content").addClass("invis"))})},500))}),$("#refresh").click(function(){state.current.grades=[],state.current.lock=[],state.save(),redraw()})});var state={current:{set:null,grades:[],lock:[],dispMode:"auto",showUnits:!1},update:function(t,e){if(grade[t]){var s=batches[t];if($("#btn-text").text(s),grade.default=grade[t],grade.set=t,this.current.set=t,null==e){this.current.grades=[];for(var a=0;a<grade.default.length;a++)this.current.grades.push("");this.save(),redraw(this.current.grades)}else redraw(e)}else console.error('Invalid gradeset "'+t+'"')},change:function(t){for(var e=parseInt($(t).attr("data-subject")),s=$(t).val(),a=0;a<grade.default.length;a++)a!=e?void 0===this.current.grades[a]&&this.current.lock.push(""):this.current.grades[e]=s;this.save(),calculate()},toggle:function(t,e){for(var s=parseInt($(t).attr("data-subject")),a=0;a<grade.default.length;a++)a!=s?void 0===this.current.lock[a]&&this.current.lock.push(!1):this.current.lock[a]=e;this.save()},load:function(){if(void 0!==typeof Storage){var t=localStorage.getItem("gwadata");if(null!=t){var e=JSON.parse(t),s=e.dispMode,a=e.showUnits,n=e.set,i=e.grades;this.current=e,this.update(n,i),displayMode(s),$("#c_nm span").text(s),unitsHandler(a),$("#c_units span").text(a?"on":"off"),void 0===this.current.lock&&(this.current.lock=[],this.save())}else redraw()}},save:function(){if(void 0!==typeof Storage){var t=this.current,e=JSON.stringify(t);localStorage.setItem("gwadata",e)}}},batches={seven:"Grade 7",eight:"Grade 8",nine:"Grade 9",ten:"Grade 10",tweleven:"Grade 10 & 11"},grade={seven:[{subject:"Integrated Science",units:1.7},{subject:"Mathematics",units:1.7},{subject:"Computer Science",units:1},{subject:"English",units:1.3},{subject:"Filipino",units:1},{subject:"Social Science",units:1},{subject:"PEHM",units:1},{subject:"Values Education",units:.7},{subject:"AdTech",units:1}],eight:[{subject:"Integrated Science",units:2},{subject:"Mathematics",units:1.7},{subject:"Computer Science",units:1},{subject:"English",units:1.3},{subject:"Filipino",units:1},{subject:"Social Science",units:1},{subject:"PEHM",units:1},{subject:"Values Education",units:.7},{subject:"AdTech",units:1},{subject:"Earth Science",units:.7}],nine:[{subject:"Biology",units:1},{subject:"Chemistry",units:1},{subject:"Physics",units:1},{subject:"Mathematics",units:1},{subject:"English",units:1},{subject:"Filipino",units:1},{subject:"Social Science",units:1},{subject:"PEHM",units:1},{subject:"Statistics",units:1},{subject:"Computer Science",units:1},{subject:"Earth Science",units:.7}],ten:[{subject:"Biology",units:1},{subject:"Chemistry",units:1},{subject:"Physics",units:1},{subject:"Mathematics",units:1.3},{subject:"English",units:1},{subject:"Filipino",units:1},{subject:"Social Science",units:1},{subject:"PEHM",units:1},{subject:"STR",units:1},{subject:"Computer Science",units:1},{subject:"Elective",units:1}],tweleven:[{subject:"STR",units:2},{subject:"Core",units:1.7},{subject:"Elective",units:1.7},{subject:"Mathematics",units:1},{subject:"English",units:1},{subject:"Filipino",units:1},{subject:"Social Science",units:1}]};